import streamlit as st

st.title("üöå Sof≈ër√ºzenet Gener√°tor")

st.write("M√°sold be egy fuvar adatsor√°t a Google Sheets-b≈ël (TAB-delimit√°lt form√°tumban):")

input_text = st.text_area("Fuvar adatsor", height=200)

# Oszlopsorrend alapj√°n (27+ oszlop)
column_names = [
    "Iktat√≥sz√°m", "Fuvar kezdete", "Fuvar v√©ge", "Orsz√°gk√≥d", "Ki√°ll√°s id≈ëpontja",
    "Ki√°ll√°s helye", "√ötic√©l", "Fuvar v√©g√©nek id≈ëpontja", "Rendsz√°m", "Ut√°nfut√≥",
    "UtasL√©tsz√°m", "Gkv I.", "Gkv II.", "Gkv III.", "Gkv IV.",
    "Megrendel≈ë", "Megrendel≈ë II.", "Kapcsolattart√≥", "Email", "Telefonsz√°m",
    "Fuvaroz√≥ neve", "K√º/Bf", "Ell√°t√°s t√≠pusa", "Megjegyz√©s 1", "Megjegyz√©s 2",
    "Megjegyz√©s 3", "Megjegyz√©s 4"
]

def parse_row(row_text):
    parts = row_text.strip().split("\t")
    parts += [""] * (len(column_names) - len(parts))
    return dict(zip(column_names, parts))

def generate_message(data):
    gkv = data.get("Gkv I.", "").strip()
    start_day = data.get("Fuvar kezdete", "").strip()
    end_date = data.get("Fuvar v√©g√©nek id≈ëpontja", "").strip()

    if not gkv:
        return "‚ö†Ô∏è Nincs megadva sof≈ër (Gkv I.)"

    # Egy napos vagy t√∂bb napos
    if start_day == data.get("Fuvar v√©ge", "").strip() or not data.get("Fuvar v√©ge", "").strip():
        date_line = f"K√ºld√∂m a munk√°t {start_day} napra (egy napos munka eset√©n)"
    else:
        date_line = f"K√ºld√∂m a munk√°t {start_day} - {end_date} napokra (t√∂bb napos munka eset√©n)"

    return f"""Szia, {gkv}  
{date_line}

*Ki√°ll√°s id≈ëpontja:* {start_day}, {data.get("Ki√°ll√°s id≈ëpontja", "").strip()}
*Ki√°ll√°s helye:* {data.get("Ki√°ll√°s helye", "").strip()}
*√ötic√©l:* {data.get("√ötic√©l", "").strip()}
*Busz:* {data.get("Rendsz√°m", "").strip()}
*V√°rhat√≥ v√©gz√©s:* {end_date}
*L√©tsz√°m:* {data.get("UtasL√©tsz√°m", "").strip()}
*Megrendel≈ë:* {data.get("Megrendel≈ë", "").strip()}
"""

if input_text:
    try:
        adat = parse_row(input_text)
        uzenet = generate_message(adat)
        st.success("üéâ √úzenet legener√°lva:")
        st.text_area("Sof≈ërnek k√ºldend≈ë √ºzenet:", value=uzenet, height=250)
    except Exception as e:
        st.error(f"Hiba t√∂rt√©nt: {e}")